@{
    ViewData["Title"] = "Employee Master";
}

<div class="container-fluid">
    <div class="row mt-3">
        <div class="col-md-8">
            <h4 class="text-secondary">Employee List</h4>
            <div class="table-responsive" style="height: 500px; overflow-y: auto; border: 1px solid #ccc;">
                <table class="table table-striped table-hover" id="tblData">
                    <thead class="table-dark sticky-top">
                        <tr>
                            <th>ID</th>
                            <th>English Name</th>
                            <th>Gujarati Name</th>
                            <th>Type</th>
                            <th>Active</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm bg-light">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0" id="formTitle">New Employee</h5>
                </div>
                <div class="card-body">
                    <input type="hidden" id="txtId" value="0" />

                    <div class="mb-3">
                        <label>English Name</label>
                        <input type="text" id="txtEng" class="form-control" placeholder="Enter Name" />
                    </div>

                    <div class="mb-3">
                        <label>Gujarati Name (Auto)</label>
                        <input type="text" id="txtGuj" class="form-control" readonly style="background-color: #e9ecef;" />
                    </div>

                    <div class="mb-3">
                        <label>Entry Type</label>
                        <select id="cmbType" class="form-select">
                            <option value="પેલ">પેલ (Pel)</option>
                            <option value="મથાળા">મથાળા (Mathala)</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label>Active</label>
                        <select id="cmbActive" class="form-select">
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>

                    <hr />
                    <div class="d-flex gap-2">
                        <button class="btn btn-success flex-fill fw-bold" onclick="saveData()">Save (Alt+S)</button>
                        <button class="btn btn-secondary flex-fill" onclick="clearForm()">New (Alt+N)</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            loadList();

            // Auto Translate when focus leaves English Name
            $('#txtEng').blur(function () {
                var text = $(this).val();
                if (text) {
                    $.get('/Employee/Translate?text=' + text, function (res) {
                        $('#txtGuj').val(res);
                    });
                }
            });

            // Shortcuts
            $(document).keydown(function(e) {
                if (e.altKey && (e.key === 's' || e.key === 'S')) {
                    e.preventDefault(); saveData();
                }
                if (e.altKey && (e.key === 'n' || e.key === 'N')) {
                    e.preventDefault(); clearForm();
                }
            });
        });

        // 1. Load Data
        function loadList() {
            $.get('/Employee/GetList', function (data) {
                var tbody = $('#tblData tbody');
                tbody.empty();
                $.each(data, function (i, item) {
                    var row = `<tr>
                        <td>${item.id}</td>
                        <td class="fw-bold">${item.englishName}</td>
                        <td>${item.gujaratiName}</td>
                        <td><span class="badge bg-info text-dark">${item.entryType}</span></td>
                        <td>${item.active}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editItem(this)">Edit</button>
                        </td>
                        <input type="hidden" class="h-id" value="${item.id}" />
                        <input type="hidden" class="h-eng" value="${item.englishName}" />
                        <input type="hidden" class="h-guj" value="${item.gujaratiName}" />
                        <input type="hidden" class="h-type" value="${item.entryType}" />
                        <input type="hidden" class="h-act" value="${item.active}" />
                    </tr>`;
                    tbody.append(row);
                });
            });
        }

        // 2. Edit Item (Populate Form)
        function editItem(btn) {
            var tr = $(btn).closest('tr');
            $('#txtId').val(tr.find('.h-id').val());
            $('#txtEng').val(tr.find('.h-eng').val());
            $('#txtGuj').val(tr.find('.h-guj').val());
            $('#cmbType').val(tr.find('.h-type').val());
            $('#cmbActive').val(tr.find('.h-act').val());

            $('#formTitle').text("Edit Employee - " + tr.find('.h-id').val());
            $('#txtEng').focus();
        }

        // 3. Save Data
        function saveData() {
            var payload = {
                Id: $('#txtId').val(),
                EnglishName: $('#txtEng').val(),
                GujaratiName: $('#txtGuj').val(),
                EntryType: $('#cmbType').val(),
                Active: $('#cmbActive').val()
            };

            $.ajax({
                url: '/Employee/Save',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(payload),
                success: function (res) {
                    if (res.success) {
                        alert(res.message);
                        clearForm();
                        loadList();
                    } else {
                        alert(res.message);
                    }
                }
            });
        }

        // 4. Reset Form
        function clearForm() {
            $('#txtId').val(0);
            $('#txtEng').val('');
            $('#txtGuj').val('');
            $('#cmbType').val('પેલ');
            $('#cmbActive').val('Yes');
            $('#formTitle').text("New Employee");
            $('#txtEng').focus();
        }
    </script>
}