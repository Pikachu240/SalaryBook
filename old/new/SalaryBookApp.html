<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Book Ultimate</title>
    <style>
        /* =========================================
           1. GLOBAL & LAYOUT STYLES (Main Frame)
           ========================================= */
        :root {
            --sidebar-width: 250px;
            --header-height: 40px;
            --primary-color: #0078d7;
            --bg-color: #f0f0f0;
            --border-color: #ccc;
            /* Form Colors */
            --input-border: #ccc;
            --save-btn: #90ee90;
            --update-btn: #87ceeb;
            --gen-btn: #ffd700;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background-color: #2d2d30;
            color: white;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            background-color: #1e1e1e;
            font-size: 1.2rem;
            font-weight: bold;
            border-bottom: 1px solid #3e3e42;
        }

        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid #3e3e42;
            transition: background 0.2s;
        }

        .menu-item:hover { background-color: #3e3e42; }

        /* MAIN CONTENT */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color);
            overflow: hidden;
        }

        /* TABS HEADER */
        .tabs-header {
            display: flex;
            background-color: #e0e0e0;
            border-bottom: 1px solid var(--border-color);
            height: var(--header-height);
            align-items: flex-end;
            padding-left: 5px;
            overflow-x: auto;
        }

        .tab {
            padding: 8px 15px;
            margin-right: 2px;
            background-color: #d0d0d0;
            border: 1px solid var(--border-color);
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            user-select: none;
            min-width: 100px;
            justify-content: space-between;
        }

        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            font-weight: bold;
            margin-bottom: -1px;
            z-index: 10;
        }

        .tab:hover:not(.active) { background-color: #dcdcdc; }

        .close-tab {
            margin-left: 10px;
            width: 16px;
            height: 16px;
            line-height: 14px;
            text-align: center;
            border-radius: 50%;
            font-size: 12px;
            color: #555;
        }

        .close-tab:hover { background-color: #c42b1c; color: white; }

        /* TABS BODY */
        .tabs-body {
            flex: 1;
            background-color: white;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        .tab-pane {
            display: none;
            height: 100%;
        }

        .tab-pane.active {
            display: block;
            animation: fadeIn 0.2s;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* =========================================
           2. DATA ENTRY FORM STYLES
           ========================================= */
        
        /* Adjusted container to fit inside tab */
        .form-content-wrapper {
            max-width: 1000px;
            margin: 0 auto; 
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 20px;
            margin-bottom: 15px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        input, select {
            padding: 8px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-size: 1rem;
            width: 100%; /* Ensure full width in grid */
            box-sizing: border-box; 
        }

        #txtUppad { text-align: right; border-color: red; }
        #txtGujaratiName { background-color: #eee; font-family: 'Arial Unicode MS', sans-serif; }

        /* Buttons */
        button {
            padding: 8px 15px;
            cursor: pointer;
            border: 1px solid #aaa;
            border-radius: 4px;
            font-weight: bold;
            transition: opacity 0.2s;
        }
        button:hover { opacity: 0.8; }
        .btn-generate { background-color: var(--gen-btn); }
        .btn-save { background-color: var(--save-btn); width: 100%; margin-top: 10px; padding: 12px; font-size: 1.1rem; }
        .btn-update { background-color: var(--update-btn); width: 100%; margin-top: 10px; padding: 12px; font-size: 1.1rem; display: none; }

        /* Data Grid */
        .grid-container {
            margin-top: 20px;
            height: 350px;
            overflow-y: auto;
            border: 1px solid #ccc;
        }
        table { width: 100%; border-collapse: collapse; }
        th {
            background-color: #ddd;
            position: sticky;
            top: 0;
            text-align: center;
            padding: 8px;
            border-bottom: 2px solid #aaa;
            z-index: 1;
        }
        td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        td[contenteditable="true"]:focus { background-color: #e6f7ff; outline: 2px solid var(--primary-color); }

        .status-msg { text-align: center; margin-top: 10px; font-style: italic; color: #666; }
        
        /* Placeholder for other tabs */
        .form-placeholder {
            border: 2px dashed #ccc; padding: 40px; text-align: center; color: #888;
            height: 80%; display: flex; justify-content: center; align-items: center; flex-direction: column;
        }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">Galaxy Book</div>
            <div class="menu-item" onclick="openForm('data-entry', 'Data Entry')">Data Entry</div>
            <div class="menu-item" onclick="openForm('rate-master', 'Rate Master')">Rate Master</div>
            <div class="menu-item" onclick="openForm('daily-report', 'Daily Report')">Daily Report</div>
            <div class="menu-item" onclick="openForm('emp-master', 'Employee Master')">Employee Master</div>
            <div class="menu-item" onclick="openForm('settings', 'Settings')">Settings</div>
            <div class="menu-item" onclick="openForm('backup', 'Backup & Restore')">Backup & Restore</div>
        </div>

        <div class="main-content">
            <div class="tabs-header" id="tabsHeader"></div>
            <div class="tabs-body" id="tabsBody">
                <div style="padding: 20px; color: #666;">
                    <h3>Welcome to Salary Book</h3>
                    <p>Select an option from the menu to begin.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* =========================================
           1. APP STATE & MOCK DATABASE
           ========================================= */
        const activeTabs = [];
        const DATA_NODE_KEY = "GalaxyBook_Data";
        
        // Mock Employee Master Data
        const mockEmployees = [
            { EnglishName: "John Doe", GujaratiName: "જોન ડો", EntryType: "પેલ" },
            { EnglishName: "Jane Smith", GujaratiName: "જેન સ્મિથ", EntryType: "મથાળા" },
            { EnglishName: "Rahul Patel", GujaratiName: "રાહુલ પટેલ", EntryType: "પેલ" },
            { EnglishName: "Amit Shah", GujaratiName: "અમિત શાહ", EntryType: "મથાળા" }
        ];

        /* =========================================
           2. TAB SYSTEM LOGIC (Main Frame)
           ========================================= */
        
        function openForm(formId, formTitle) {
            // 1. Check if exists
            if (activeTabs.includes(formId)) {
                activateTab(formId);
                return;
            }

            const tabsHeader = document.getElementById('tabsHeader');
            const tabsBody = document.getElementById('tabsBody');

            // 2. Create Header
            const tabBtn = document.createElement('div');
            tabBtn.className = 'tab';
            tabBtn.id = `tab-btn-${formId}`;
            tabBtn.innerHTML = `${formTitle} <span class="close-tab" onclick="closeTab(event, '${formId}')">X</span>`;
            tabBtn.onclick = (e) => { if(!e.target.classList.contains('close-tab')) activateTab(formId); };

            // 3. Create Content
            const tabContent = document.createElement('div');
            tabContent.className = 'tab-pane';
            tabContent.id = `tab-content-${formId}`;
            
            // INJECT HTML CONTENT BASED ON ID
            tabContent.innerHTML = getFormContent(formId, formTitle);

            // 4. Add to DOM
            tabsHeader.appendChild(tabBtn);
            tabsBody.appendChild(tabContent);
            activeTabs.push(formId);

            // 5. Activate and Initialize
            activateTab(formId);

            // SPECIAL INITIALIZATION FOR DATA ENTRY FORM
            if(formId === 'data-entry') {
                initDataEntry();
            }
        }

        function activateTab(formId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById(`tab-btn-${formId}`).classList.add('active');
            document.getElementById(`tab-content-${formId}`).classList.add('active');
        }

        function closeTab(event, formId) {
            event.stopPropagation();
            document.getElementById(`tab-btn-${formId}`).remove();
            document.getElementById(`tab-content-${formId}`).remove();
            const index = activeTabs.indexOf(formId);
            if (index > -1) activeTabs.splice(index, 1);
            if (activeTabs.length > 0) activateTab(activeTabs[activeTabs.length - 1]);
        }

        /**
         * Returns the HTML string for the tab content.
         */
        function getFormContent(id, title) {
            if(id === 'data-entry') {
                return `
                <div class="form-content-wrapper">
                    <h2 style="margin-top:0;">${title}</h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label>English Name:</label>
                            <select id="cmbEnglishName" onchange="handleNameChange()"></select>
                        </div>
                        <div class="form-group">
                            <label>Gujarati Name:</label>
                            <input type="text" id="txtGujaratiName" readonly>
                        </div>
                        <div class="form-group">
                            <label>Date:</label>
                            <input type="date" id="dtpDate">
                        </div>
                        <div class="form-group">
                            <button class="btn-generate" onclick="generateData()">Generate (Alt+G)</button>
                        </div>
                    </div>

                    <div class="form-row" style="grid-template-columns: 1fr 1fr 2fr;">
                        <div class="form-group">
                            <label>Type:</label>
                            <select id="cmbEntryType">
                                <option value="પેલ">પેલ</option>
                                <option value="મથાળા">મથાળા</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label style="color:red;">Uppad:</label>
                            <input type="number" id="txtUppad" value="0">
                        </div>
                        <div></div>
                    </div>

                    <div class="grid-container">
                        <table id="dataGridView">
                            <thead>
                                <tr>
                                    <th style="width:50px;">#</th>
                                    <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>Ct</th>
                                </tr>
                            </thead>
                            <tbody id="gridBody"></tbody>
                        </table>
                        <button onclick="addNewRow()" style="margin-top:5px; width:100%; background:#eee;">+ Add New Row</button>
                    </div>

                    <button id="btnSave" class="btn-save" onclick="saveData()">Save Data (Alt+S)</button>
                    <button id="btnUpdate" class="btn-update" onclick="updateData()">Update Data (Alt+U)</button>
                    
                    <div id="statusMsg" class="status-msg">Ready</div>
                </div>
                `;
            }

            // Return generic placeholder for other menus
            return `
                <div class="form-placeholder">
                    <h2>${title}</h2>
                    <p>This module (${id}) is under construction.</p>
                </div>
            `;
        }

        /* =========================================
           3. DATA ENTRY FORM LOGIC
           ========================================= */

        // Called when the tab is opened
        function initDataEntry() {
            // Set Date
            document.getElementById('dtpDate').valueAsDate = new Date();
            // Load Employees
            loadEmployeeMaster();
            // Add Empty Rows
            for(let i=0; i<5; i++) addNewRow();
            // Add Shortcuts
            document.addEventListener('keydown', handleShortcuts);
        }

        function loadEmployeeMaster() {
            const cmb = document.getElementById('cmbEnglishName');
            // Logic to filter if needed based on Type
            const filtered = mockEmployees;

            cmb.innerHTML = '<option value="">-- Select --</option>';
            filtered.forEach(emp => {
                let opt = document.createElement('option');
                opt.value = emp.EnglishName;
                opt.dataset.guj = emp.GujaratiName;
                opt.text = emp.EnglishName;
                cmb.appendChild(opt);
            });
        }

        function handleNameChange() {
            const cmb = document.getElementById('cmbEnglishName');
            const txtGuj = document.getElementById('txtGujaratiName');
            const selectedOpt = cmb.options[cmb.selectedIndex];
            if(selectedOpt && selectedOpt.dataset.guj) {
                txtGuj.value = selectedOpt.dataset.guj;
            }
        }

        function handleShortcuts(e) {
            // Only trigger if Data Entry tab is active
            if(!document.getElementById('tab-content-data-entry')) return;

            if (e.altKey && e.key.toLowerCase() === 's') { e.preventDefault(); if(document.getElementById('btnSave').offsetParent) saveData(); }
            if (e.altKey && e.key.toLowerCase() === 'u') { e.preventDefault(); if(document.getElementById('btnUpdate').offsetParent) updateData(); }
            if (e.altKey && e.key.toLowerCase() === 'g') { e.preventDefault(); generateData(); }
        }

        function addNewRow(data = null) {
            const tbody = document.getElementById('gridBody');
            if(!tbody) return; // Guard clause in case tab is closed
            
            const row = document.createElement('tr');
            const rowId = data ? data.Id : '';
            const createCell = (val) => `<td contenteditable="true">${val || ''}</td>`;

            row.innerHTML = `
                <td style="background:#eee; font-size:0.8rem; color:#666;" data-id="${rowId}">#</td>
                ${createCell(data ? data.Col_A : '')} ${createCell(data ? data.Col_B : '')}
                ${createCell(data ? data.Col_C : '')} ${createCell(data ? data.Col_D : '')}
                ${createCell(data ? data.Col_E : '')} ${createCell(data ? data.Col_F : '')}
                ${createCell(data ? data.Col_G : '')} ${createCell(data ? data.Col_Ct : '')}
            `;
            tbody.appendChild(row);
        }

        function clearGrid() {
            document.getElementById('gridBody').innerHTML = '';
        }

        function getStoredData() {
            const json = localStorage.getItem(DATA_NODE_KEY);
            return json ? JSON.parse(json) : [];
        }

        function generateData() {
            const name = document.getElementById('cmbEnglishName').value;
            if (!name) { alert("Select Name"); return; }
            
            const date = document.getElementById('dtpDate').value;
            const type = document.getElementById('cmbEntryType').value;

            const allData = getStoredData();
            const rows = allData.filter(x => x.EmpName_English === name && x.EntryDate === date && x.EntryType === type);

            if (rows.length > 0) {
                clearGrid();
                document.getElementById('txtUppad').value = rows[0].Uppad;
                rows.forEach(r => addNewRow(r));
                document.getElementById('btnSave').style.display = 'none';
                document.getElementById('btnUpdate').style.display = 'block';
                document.getElementById('statusMsg').innerText = "Data Loaded (Update Mode)";
            } else {
                clearGrid();
                for(let i=0; i<5; i++) addNewRow();
                document.getElementById('txtUppad').value = "0";
                document.getElementById('btnSave').style.display = 'block';
                document.getElementById('btnUpdate').style.display = 'none';
                document.getElementById('statusMsg').innerText = "No Data Found (Save Mode)";
            }
        }

        function saveData() {
            const name = document.getElementById('cmbEnglishName').value;
            if (!name) { alert("Please select a name"); return; }
            const allData = getStoredData();
            const nextId = allData.length > 0 ? Math.max(...allData.map(d => d.Id || 0)) + 1 : 1;
            const newData = collectGridData(nextId);
            
            if(newData.length === 0) { alert("Grid is empty"); return; }
            localStorage.setItem(DATA_NODE_KEY, JSON.stringify([...allData, ...newData]));
            
            alert("Saved Successfully!");
            clearGrid();
            for(let i=0; i<5; i++) addNewRow();
        }

        function updateData() {
            const name = document.getElementById('cmbEnglishName').value;
            const date = document.getElementById('dtpDate').value;
            const type = document.getElementById('cmbEntryType').value;
            let allData = getStoredData();
            
            // Remove old entries
            allData = allData.filter(x => !(x.EmpName_English === name && x.EntryDate === date && x.EntryType === type));
            
            // Add new entries
            const nextId = allData.length > 0 ? Math.max(...allData.map(d => d.Id || 0)) + 1 : 1;
            const newData = collectGridData(nextId);
            localStorage.setItem(DATA_NODE_KEY, JSON.stringify([...allData, ...newData]));

            alert("Updated Successfully!");
            document.getElementById('btnSave').style.display = 'block';
            document.getElementById('btnUpdate').style.display = 'none';
            clearGrid();
            for(let i=0; i<5; i++) addNewRow();
        }

        function collectGridData(startId) {
            const rows = document.querySelectorAll('#gridBody tr');
            const result = [];
            let idCounter = startId;
            const commonData = {
                EmpName_English: document.getElementById('cmbEnglishName').value,
                EmpName_Gujarati: document.getElementById('txtGujaratiName').value,
                EntryDate: document.getElementById('dtpDate').value,
                EntryType: document.getElementById('cmbEntryType').value,
                Uppad: document.getElementById('txtUppad').value
            };

            rows.forEach(tr => {
                const cells = tr.querySelectorAll('td');
                const valA = cells[1].innerText.trim();
                const valB = cells[2].innerText.trim();
                // Check if row has at least some data
                if(valA || valB || cells[3].innerText.trim()) {
                    result.push({
                        Id: idCounter++, ...commonData,
                        Col_A: valA, Col_B: valB, Col_C: cells[3].innerText.trim(),
                        Col_D: cells[4].innerText.trim(), Col_E: cells[5].innerText.trim(),
                        Col_F: cells[6].innerText.trim(), Col_G: cells[7].innerText.trim(),
                        Col_Ct: cells[8].innerText.trim(),
                    });
                }
            });
            return result;
        }
    </script>
</body>
</html>