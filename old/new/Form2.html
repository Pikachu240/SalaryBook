<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Book Ultimate</title>
    <style>
        /* =========================================
           GLOBAL & LAYOUT STYLES
           ========================================= */
        :root {
            --sidebar-width: 250px;
            --header-height: 40px;
            --primary-color: #0078d7;
            --bg-color: #f0f0f0;
            --border-color: #ccc;
            --input-border: #ccc;
            --save-btn: #90ee90;
            --update-btn: #87ceeb;
            --gen-btn: #ffd700;
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        .app-container { display: flex; height: 100vh; }
        
        /* SIDEBAR */
        .sidebar { width: var(--sidebar-width); background-color: #2d2d30; color: white; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; background-color: #1e1e1e; font-weight: bold; border-bottom: 1px solid #3e3e42; }
        .menu-item { padding: 15px 20px; cursor: pointer; border-bottom: 1px solid #3e3e42; }
        .menu-item:hover { background-color: #3e3e42; }

        /* MAIN CONTENT */
        .main-content { flex: 1; display: flex; flex-direction: column; background-color: var(--bg-color); overflow: hidden; }
        .tabs-header { display: flex; background-color: #e0e0e0; height: var(--header-height); align-items: flex-end; padding-left: 5px; }
        .tab { padding: 8px 15px; margin-right: 2px; background-color: #d0d0d0; border-radius: 4px 4px 0 0; cursor: pointer; display: flex; align-items: center; min-width: 100px; justify-content: space-between; user-select: none; }
        .tab.active { background-color: white; font-weight: bold; padding-bottom: 9px; }
        .close-tab { margin-left: 10px; width: 16px; height: 16px; border-radius: 50%; text-align: center; font-size: 12px; color: #555; }
        .close-tab:hover { background-color: #c42b1c; color: white; }
        
        /* TABS BODY */
        .tabs-body { flex: 1; background-color: white; padding: 20px; overflow-y: auto; }
        .tab-pane { display: none; height: 100%; }
        .tab-pane.active { display: block; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* FORM STYLES */
        .form-content-wrapper { max-width: 1000px; margin: 0 auto; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 20px; margin-bottom: 15px; align-items: end; }
        .form-group { display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
        input, select { padding: 8px; border: 1px solid var(--input-border); border-radius: 4px; width: 100%; box-sizing: border-box; }
        button { padding: 8px 15px; cursor: pointer; border-radius: 4px; font-weight: bold; border: 1px solid #aaa; }
        button:hover { opacity: 0.8; }
        
        /* SPECIFIC COLORS */
        .btn-generate { background-color: var(--gen-btn); }
        .btn-save { background-color: var(--save-btn); width: 100%; margin-top: 10px; padding: 12px; }
        .btn-update { background-color: var(--update-btn); width: 100%; margin-top: 10px; padding: 12px; display: none; }

        /* GRID */
        .grid-container { margin-top: 20px; height: 350px; overflow-y: auto; border: 1px solid #ccc; }
        table { width: 100%; border-collapse: collapse; }
        th { background-color: #ddd; position: sticky; top: 0; padding: 8px; text-align: center; }
        td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        
        .status-msg { text-align: center; margin-top: 10px; font-style: italic; color: #666; }
        .form-placeholder { border: 2px dashed #ccc; padding: 40px; text-align: center; color: #888; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">Galaxy Book</div>
            <div class="menu-item" onclick="openForm('data-entry', 'Data Entry')">Data Entry</div>
            <div class="menu-item" onclick="openForm('rate-master', 'Rate Master')">Rate Master</div>
            <div class="menu-item" onclick="openForm('daily-report', 'Daily Report')">Daily Report</div>
            <div class="menu-item" onclick="openForm('emp-master', 'Employee Master')">Employee Master</div>
        </div>

        <div class="main-content">
            <div class="tabs-header" id="tabsHeader"></div>
            <div class="tabs-body" id="tabsBody">
                <div style="padding: 20px; color: #666;">
                    <h3>Welcome to Salary Book</h3>
                    <p>Select an option from the menu.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const activeTabs = [];
        const DATA_NODE_KEY = "GalaxyBook_Data";
        const RATE_NODE_KEY = "GalaxyBook_Rates";
        
        // MOCK DATA
        const mockEmployees = [
            { EnglishName: "John Doe", GujaratiName: "જોન ડો" },
            { EnglishName: "Jane Smith", GujaratiName: "જેન સ્મિથ" }
        ];

        // --- TAB SYSTEM ---
        function openForm(formId, formTitle) {
            if (activeTabs.includes(formId)) { activateTab(formId); return; }

            const tabBtn = document.createElement('div');
            tabBtn.className = 'tab';
            tabBtn.id = `tab-btn-${formId}`;
            tabBtn.innerHTML = `${formTitle} <span class="close-tab" onclick="closeTab(event, '${formId}')">X</span>`;
            tabBtn.onclick = (e) => { if(!e.target.classList.contains('close-tab')) activateTab(formId); };

            const tabContent = document.createElement('div');
            tabContent.className = 'tab-pane';
            tabContent.id = `tab-content-${formId}`;
            tabContent.innerHTML = getFormContent(formId, formTitle);

            document.getElementById('tabsHeader').appendChild(tabBtn);
            document.getElementById('tabsBody').appendChild(tabContent);
            activeTabs.push(formId);
            activateTab(formId);

            if(formId === 'data-entry') initDataEntry();
            if(formId === 'rate-master') initRateMaster();
        }

        function activateTab(formId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById(`tab-btn-${formId}`).classList.add('active');
            document.getElementById(`tab-content-${formId}`).classList.add('active');
        }

        function closeTab(event, formId) {
            event.stopPropagation();
            document.getElementById(`tab-btn-${formId}`).remove();
            document.getElementById(`tab-content-${formId}`).remove();
            const index = activeTabs.indexOf(formId);
            if (index > -1) activeTabs.splice(index, 1);
            if (activeTabs.length > 0) activateTab(activeTabs[activeTabs.length - 1]);
        }

        function getFormContent(id, title) {
            if (id === 'rate-master') {
                return `
                <div class="form-content-wrapper" style="max-width: 500px;">
                    <h2 style="margin-top:0;">${title}</h2>
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label>Type:</label>
                        <select id="cmbRateType" onchange="loadRates()">
                            <option value="પેલ">પેલ</option>
                            <option value="મથાળા">મથાળા</option>
                        </select>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; align-items: center;">
                        <label>Val A:</label> <input type="number" id="txtA" class="rate-input" value="0">
                        <label>Val B:</label> <input type="number" id="txtB" class="rate-input" value="0">
                        <label>Val C:</label> <input type="number" id="txtC" class="rate-input" value="0">
                        <label>Val D:</label> <input type="number" id="txtD" class="rate-input" value="0">
                        <label>Val E:</label> <input type="number" id="txtE" class="rate-input" value="0">
                        <label>Val F:</label> <input type="number" id="txtF" class="rate-input" value="0">
                        <label>Val G:</label> <input type="number" id="txtG" class="rate-input" value="0">
                    </div>
                    <button id="btnSaveRate" class="btn-save" onclick="saveRates()" style="margin-top: 30px;">Save Rates (Alt+S)</button>
                    <div id="rateStatus" class="status-msg">Ready</div>
                </div>`;
            }
            if (id === 'data-entry') {
                return `
                <div class="form-content-wrapper">
                    <h2 style="margin-top:0;">${title}</h2>
                    <div class="form-row">
                        <div class="form-group"><label>Name:</label><select id="cmbEnglishName" onchange="handleNameChange()"></select></div>
                        <div class="form-group"><label>Gujarati:</label><input type="text" id="txtGujaratiName" readonly></div>
                        <div class="form-group"><label>Date:</label><input type="date" id="dtpDate"></div>
                        <div class="form-group"><button class="btn-generate" onclick="generateData()">Generate (Alt+G)</button></div>
                    </div>
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 2fr;">
                        <div class="form-group"><label>Type:</label><select id="cmbEntryType"><option>પેલ</option><option>મથાળા</option></select></div>
                        <div class="form-group"><label style="color:red;">Uppad:</label><input type="number" id="txtUppad" value="0"></div>
                        <div></div>
                    </div>
                    <div class="grid-container">
                        <table id="dataGridView"><thead><tr><th>#</th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>Ct</th></tr></thead><tbody id="gridBody"></tbody></table>
                        <button onclick="addNewRow()" style="margin-top:5px; width:100%; background:#eee;">+ Add New Row</button>
                    </div>
                    <button id="btnSave" class="btn-save" onclick="saveData()">Save Data (Alt+S)</button>
                    <button id="btnUpdate" class="btn-update" onclick="updateData()">Update Data (Alt+U)</button>
                    <div id="statusMsg" class="status-msg">Ready</div>
                </div>`;
            }
            return `<div class="form-placeholder"><h2>${title}</h2><p>Under Construction</p></div>`;
        }

        // --- RATE MASTER FUNCTIONS ---
        function initRateMaster() {
            loadRates();
            document.addEventListener('keydown', function(e) {
                if(document.getElementById('tab-content-rate-master') && e.altKey && e.key.toLowerCase() === 's') { e.preventDefault(); saveRates(); }
            });
        }
        function getStoredRates() { return JSON.parse(localStorage.getItem(RATE_NODE_KEY) || "[]"); }
        function loadRates() {
            const type = document.getElementById('cmbRateType').value;
            const rate = getStoredRates().find(x => x.RateType === type);
            const setVal = (id, val) => document.getElementById(id).value = val || 0;
            if (rate) {
                ['A','B','C','D','E','F','G'].forEach(x => setVal('txt'+x, rate['Val_'+x]));
                document.getElementById('rateStatus').innerText = "Rates Loaded";
            } else {
                ['A','B','C','D','E','F','G'].forEach(x => setVal('txt'+x, 0));
                document.getElementById('rateStatus').innerText = "No rates found (Default 0)";
            }
        }
        function saveRates() {
            const btn = document.getElementById('btnSaveRate');
            btn.innerText = "Saving..."; btn.disabled = true;
            const type = document.getElementById('cmbRateType').value;
            let allRates = getStoredRates().filter(x => x.RateType !== type);
            
            const newRate = { RateType: type };
            ['A','B','C','D','E','F','G'].forEach(x => newRate['Val_'+x] = document.getElementById('txt'+x).value);
            
            allRates.push(newRate);
            localStorage.setItem(RATE_NODE_KEY, JSON.stringify(allRates));
            setTimeout(() => { alert("Saved!"); btn.innerText = "Save Rates (Alt+S)"; btn.disabled = false; }, 300);
        }

        // --- DATA ENTRY FUNCTIONS ---
        function initDataEntry() {
            document.getElementById('dtpDate').valueAsDate = new Date();
            loadEmployeeMaster();
            for(let i=0; i<5; i++) addNewRow();
            document.addEventListener('keydown', handleShortcuts);
        }
        function loadEmployeeMaster() {
            const cmb = document.getElementById('cmbEnglishName');
            cmb.innerHTML = '<option value="">-- Select --</option>';
            mockEmployees.forEach(emp => {
                let opt = document.createElement('option');
                opt.value = emp.EnglishName; opt.dataset.guj = emp.GujaratiName; opt.text = emp.EnglishName;
                cmb.appendChild(opt);
            });
        }
        function handleNameChange() {
            const cmb = document.getElementById('cmbEnglishName');
            if(cmb.selectedIndex > 0) document.getElementById('txtGujaratiName').value = cmb.options[cmb.selectedIndex].dataset.guj;
        }
        function handleShortcuts(e) {
            if(!document.getElementById('tab-content-data-entry')) return;
            if (e.altKey && e.key === 's' && document.getElementById('btnSave').offsetParent) saveData();
            if (e.altKey && e.key === 'u' && document.getElementById('btnUpdate').offsetParent) updateData();
            if (e.altKey && e.key === 'g') generateData();
        }
        function addNewRow(data) {
            const tbody = document.getElementById('gridBody');
            if(!tbody) return;
            const row = document.createElement('tr');
            const c = (v) => `<td contenteditable="true">${v||''}</td>`;
            row.innerHTML = `<td style="background:#eee;">#</td>${c(data?.Col_A)}${c(data?.Col_B)}${c(data?.Col_C)}${c(data?.Col_D)}${c(data?.Col_E)}${c(data?.Col_F)}${c(data?.Col_G)}${c(data?.Col_Ct)}`;
            tbody.appendChild(row);
        }
        function getStoredData() { return JSON.parse(localStorage.getItem(DATA_NODE_KEY) || "[]"); }
        function generateData() {
            const name = document.getElementById('cmbEnglishName').value;
            const date = document.getElementById('dtpDate').value;
            const type = document.getElementById('cmbEntryType').value;
            const rows = getStoredData().filter(x => x.EmpName_English === name && x.EntryDate === date && x.EntryType === type);
            document.getElementById('gridBody').innerHTML = '';
            if(rows.length > 0) {
                document.getElementById('txtUppad').value = rows[0].Uppad;
                rows.forEach(r => addNewRow(r));
                document.getElementById('btnSave').style.display = 'none';
                document.getElementById('btnUpdate').style.display = 'block';
            } else {
                for(let i=0; i<5; i++) addNewRow();
                document.getElementById('btnSave').style.display = 'block';
                document.getElementById('btnUpdate').style.display = 'none';
            }
        }
        function saveData() {
            const allData = getStoredData();
            const newData = collectGrid();
            if(newData.length === 0) return alert("Empty");
            localStorage.setItem(DATA_NODE_KEY, JSON.stringify([...allData, ...newData]));
            alert("Saved"); document.getElementById('gridBody').innerHTML = ''; for(let i=0; i<5; i++) addNewRow();
        }
        function updateData() {
            const name = document.getElementById('cmbEnglishName').value;
            const date = document.getElementById('dtpDate').value;
            const type = document.getElementById('cmbEntryType').value;
            let allData = getStoredData().filter(x => !(x.EmpName_English === name && x.EntryDate === date && x.EntryType === type));
            localStorage.setItem(DATA_NODE_KEY, JSON.stringify([...allData, ...collectGrid()]));
            alert("Updated"); document.getElementById('gridBody').innerHTML = ''; for(let i=0; i<5; i++) addNewRow();
            document.getElementById('btnSave').style.display = 'block'; document.getElementById('btnUpdate').style.display = 'none';
        }
        function collectGrid() {
            const rows = document.querySelectorAll('#gridBody tr');
            const res = [];
            const common = {
                EmpName_English: document.getElementById('cmbEnglishName').value,
                EntryDate: document.getElementById('dtpDate').value,
                EntryType: document.getElementById('cmbEntryType').value,
                Uppad: document.getElementById('txtUppad').value
            };
            rows.forEach(tr => {
                const c = tr.querySelectorAll('td');
                if(c[1].innerText || c[2].innerText) {
                    res.push({ ...common, Col_A: c[1].innerText, Col_B: c[2].innerText, Col_C: c[3].innerText, Col_D: c[4].innerText, Col_E: c[5].innerText, Col_F: c[6].innerText, Col_G: c[7].innerText, Col_Ct: c[8].innerText });
                }
            });
            return res;
        }
    </script>
</body>
</html>