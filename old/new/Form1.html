<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Entry (Web)</title>
    <style>
        :root {
            --bg-color: #f4f4f4;
            --input-border: #ccc;
            --primary-btn: #0078d7;
            --save-btn: #90ee90; /* LightGreen */
            --update-btn: #87ceeb; /* SkyBlue */
            --gen-btn: #ffd700; /* Gold */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            background: white;
            width: 900px; /* Matches your Size(950, 650) roughly */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* --- FORM GRID LAYOUT --- */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 20px;
            margin-bottom: 15px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        input, select {
            padding: 8px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            font-size: 1rem;
        }

        /* Specific Control Styling from C# */
        #txtUppad {
            text-align: right;
            border-color: red; /* Visual cue from your code */
        }

        #txtGujaratiName {
            background-color: #eee;
            font-family: 'Arial Unicode MS', sans-serif; 
        }

        /* --- BUTTONS --- */
        button {
            padding: 8px 15px;
            cursor: pointer;
            border: 1px solid #aaa;
            border-radius: 4px;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        button:hover { opacity: 0.8; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-generate { background-color: var(--gen-btn); }
        .btn-save { background-color: var(--save-btn); width: 100%; margin-top: 10px; padding: 12px; font-size: 1.1rem; }
        .btn-update { background-color: var(--update-btn); width: 100%; margin-top: 10px; padding: 12px; font-size: 1.1rem; display: none; }

        /* --- DATA GRID VIEW (Table) --- */
        .grid-container {
            margin-top: 20px;
            height: 350px;
            overflow-y: auto;
            border: 1px solid #ccc;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #ddd;
            position: sticky;
            top: 0;
            text-align: center;
            padding: 8px;
            border-bottom: 2px solid #aaa;
        }

        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        /* Make cells look editable */
        td[contenteditable="true"]:focus {
            background-color: #e6f7ff;
            outline: 2px solid var(--primary-btn);
        }

        /* Helper for "No Data" */
        .status-msg {
            text-align: center;
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>

<div class="container">
    <h2 style="margin-top:0;">Employee Entry</h2>

    <div class="form-row">
        <div class="form-group">
            <label>English Name:</label>
            <select id="cmbEnglishName" onchange="handleNameChange()"></select>
        </div>
        <div class="form-group">
            <label>Gujarati Name:</label>
            <input type="text" id="txtGujaratiName" readonly>
        </div>
        <div class="form-group">
            <label>Date:</label>
            <input type="date" id="dtpDate">
        </div>
        <div class="form-group">
            <button class="btn-generate" onclick="generateData()">Generate (Alt+G)</button>
        </div>
    </div>

    <div class="form-row" style="grid-template-columns: 1fr 1fr 2fr;">
        <div class="form-group">
            <label>Type:</label>
            <select id="cmbEntryType">
                <option value="પેલ">પેલ</option>
                <option value="મથાળા">મથાળા</option>
            </select>
        </div>
        <div class="form-group">
            <label style="color:red;">Uppad:</label>
            <input type="number" id="txtUppad" value="0">
        </div>
        <div></div>
    </div>

    <div class="grid-container">
        <table id="dataGridView">
            <thead>
                <tr>
                    <th style="width:50px;">#</th> <th>A</th>
                    <th>B</th>
                    <th>C</th>
                    <th>D</th>
                    <th>E</th>
                    <th>F</th>
                    <th>G</th>
                    <th>Ct</th>
                </tr>
            </thead>
            <tbody id="gridBody">
                </tbody>
        </table>
        <button onclick="addNewRow()" style="margin-top:5px; width:100%; background:#eee;">+ Add New Row</button>
    </div>

    <button id="btnSave" class="btn-save" onclick="saveData()">Save Data (Alt+S)</button>
    <button id="btnUpdate" class="btn-update" onclick="updateData()">Update Data (Alt+U)</button>
    
    <div id="statusMsg" class="status-msg">Ready</div>
</div>

<script>
    // --- 1. MOCK DATA & CONFIG ---
    // In real app, these replace your Firebase calls
    const DATA_NODE_KEY = "GalaxyBook_Data"; 
    
    // Mock Employee Master
    const mockEmployees = [
        { EnglishName: "John Doe", GujaratiName: "જોન ડો", EntryType: "પેલ" },
        { EnglishName: "Jane Smith", GujaratiName: "જેન સ્મિથ", EntryType: "મથાળા" },
        { EnglishName: "Rahul Patel", GujaratiName: "રાહુલ પટેલ", EntryType: "પેલ" }
    ];

    // --- 2. INITIALIZATION ---
    window.onload = function() {
        // Set default date to today
        document.getElementById('dtpDate').valueAsDate = new Date();
        loadEmployeeMaster();
        
        // Add 10 empty rows to start (simulating typical grid behavior)
        for(let i=0; i<5; i++) addNewRow();

        // Keyboard Shortcuts
        document.addEventListener('keydown', handleShortcuts);
    };

    function loadEmployeeMaster() {
        const cmb = document.getElementById('cmbEnglishName');
        const type = document.getElementById('cmbEntryType').value;
        
        // Filter based on Type (just like your C# code)
        // Note: For demo simplicity, I'm showing all, but you can uncomment filter logic
        const filtered = mockEmployees; // .filter(e => e.EntryType === type);

        cmb.innerHTML = '<option value="">-- Select --</option>';
        filtered.forEach(emp => {
            let opt = document.createElement('option');
            opt.value = emp.EnglishName;
            opt.dataset.guj = emp.GujaratiName; // Store gujarati name in data attribute
            opt.text = emp.EnglishName;
            cmb.appendChild(opt);
        });
    }

    // --- 3. EVENT HANDLERS ---
    
    function handleNameChange() {
        const cmb = document.getElementById('cmbEnglishName');
        const txtGuj = document.getElementById('txtGujaratiName');
        
        // 1. Check local data attribute first
        const selectedOpt = cmb.options[cmb.selectedIndex];
        if(selectedOpt && selectedOpt.dataset.guj) {
            txtGuj.value = selectedOpt.dataset.guj;
        } else {
            // 2. If not found, Simulate Google Translate API call
            translateText(cmb.value);
        }
    }

    // Simulates: C# TranslateText()
    async function translateText(text) {
        if(!text) return;
        // NOTE: Real Google Translate API requires a key or proxy due to CORS. 
        // For this demo, we mock it. 
        console.log(`Simulating translation for: ${text}`);
        // If you had a real endpoint: fetch(url)...
    }

    function handleShortcuts(e) {
        // Alt + S = Save
        if (e.altKey && e.key.toLowerCase() === 's') {
            e.preventDefault();
            if(document.getElementById('btnSave').style.display !== 'none') saveData();
        }
        // Alt + U = Update
        if (e.altKey && e.key.toLowerCase() === 'u') {
            e.preventDefault();
            if(document.getElementById('btnUpdate').style.display !== 'none') updateData();
        }
        // Alt + G = Generate
        if (e.altKey && e.key.toLowerCase() === 'g') {
            e.preventDefault();
            generateData();
        }
    }

    // --- 4. GRID LOGIC ---
    
    function addNewRow(data = null) {
        const tbody = document.getElementById('gridBody');
        const row = document.createElement('tr');
        
        // If loading data, store ID, otherwise null
        const rowId = data ? data.Id : '';

        // Helper to create cell
        const createCell = (val) => `<td contenteditable="true">${val || ''}</td>`;

        row.innerHTML = `
            <td style="background:#eee; font-size:0.8rem; color:#666;" data-id="${rowId}">#</td>
            ${createCell(data ? data.Col_A : '')}
            ${createCell(data ? data.Col_B : '')}
            ${createCell(data ? data.Col_C : '')}
            ${createCell(data ? data.Col_D : '')}
            ${createCell(data ? data.Col_E : '')}
            ${createCell(data ? data.Col_F : '')}
            ${createCell(data ? data.Col_G : '')}
            ${createCell(data ? data.Col_Ct : '')}
        `;
        tbody.appendChild(row);
    }

    function clearGrid() {
        document.getElementById('gridBody').innerHTML = '';
    }

    // --- 5. CORE LOGIC (GENERATE / SAVE / UPDATE) ---

    // Helper: Read from LocalStorage
    function getStoredData() {
        const json = localStorage.getItem(DATA_NODE_KEY);
        return json ? JSON.parse(json) : [];
    }

    // Simulates: BtnGenerate_Click
    function generateData() {
        const name = document.getElementById('cmbEnglishName').value;
        if (!name) { alert("Select Name"); return; }
        
        const date = document.getElementById('dtpDate').value;
        const type = document.getElementById('cmbEntryType').value;

        const allData = getStoredData();
        
        // Filter Logic
        const rows = allData.filter(x => 
            x.EmpName_English === name && 
            x.EntryDate === date && 
            x.EntryType === type
        );

        if (rows.length > 0) {
            // Data Found -> Switch to Update Mode
            clearGrid();
            document.getElementById('txtUppad').value = rows[0].Uppad;
            
            rows.forEach(r => addNewRow(r));
            
            document.getElementById('btnSave').style.display = 'none';
            document.getElementById('btnUpdate').style.display = 'block';
            setStatus("Data Loaded (Update Mode)");
        } else {
            // No Data -> Save Mode
            clearGrid();
            for(let i=0; i<5; i++) addNewRow(); // Add blanks
            document.getElementById('txtUppad').value = "0";
            
            document.getElementById('btnSave').style.display = 'block';
            document.getElementById('btnUpdate').style.display = 'none';
            setStatus("No Data Found (Save Mode)");
        }
    }

    // Simulates: BtnSave_Click
    function saveData() {
        const name = document.getElementById('cmbEnglishName').value;
        if (!name) { alert("Please select a name"); return; }

        const allData = getStoredData();
        const nextId = allData.length > 0 ? Math.max(...allData.map(d => d.Id || 0)) + 1 : 1;
        
        const newData = collectGridData(nextId);
        
        if(newData.length === 0) { alert("Grid is empty"); return; }

        // Append to storage
        const finalData = [...allData, ...newData];
        localStorage.setItem(DATA_NODE_KEY, JSON.stringify(finalData));
        
        alert("Saved Successfully!");
        clearGrid();
        for(let i=0; i<5; i++) addNewRow(); // Reset UI
    }

    // Simulates: BtnUpdate_Click
    function updateData() {
        const name = document.getElementById('cmbEnglishName').value;
        const date = document.getElementById('dtpDate').value;
        const type = document.getElementById('cmbEntryType').value;

        let allData = getStoredData();
        
        // 1. Remove old records for this criteria
        // (In a real DB update, you might update by ID, but your C# logic removed and re-added)
        const gridIds = []; // Track IDs kept
        
        // Collect current grid data
        // We reuse nextId logic slightly differently here, but for simple LocalStorage:
        // We will just Delete All matching this criteria and Insert New from Grid
        
        allData = allData.filter(x => !(
            x.EmpName_English === name && 
            x.EntryDate === date && 
            x.EntryType === type
        ));

        // Generate new IDs or keep old ones logic is complex in JS without backend.
        // Simplified approach: Add new records as fresh entries
        const nextId = allData.length > 0 ? Math.max(...allData.map(d => d.Id || 0)) + 1 : 1;
        const newData = collectGridData(nextId);

        const finalData = [...allData, ...newData];
        localStorage.setItem(DATA_NODE_KEY, JSON.stringify(finalData));

        alert("Updated Successfully!");
        
        // Reset UI
        document.getElementById('btnSave').style.display = 'block';
        document.getElementById('btnUpdate').style.display = 'none';
        clearGrid();
        for(let i=0; i<5; i++) addNewRow();
    }

    // Helper: Scrape table rows into Objects
    function collectGridData(startId) {
        const rows = document.querySelectorAll('#gridBody tr');
        const result = [];
        let idCounter = startId;

        const commonData = {
            EmpName_English: document.getElementById('cmbEnglishName').value,
            EmpName_Gujarati: document.getElementById('txtGujaratiName').value,
            EntryDate: document.getElementById('dtpDate').value,
            EntryType: document.getElementById('cmbEntryType').value,
            Uppad: document.getElementById('txtUppad').value
        };

        rows.forEach(tr => {
            const cells = tr.querySelectorAll('td');
            // cells[0] is #, cells[1] is A, etc.
            const valA = cells[1].innerText.trim();
            const valB = cells[2].innerText.trim();
            
            // Only save if at least one cell has data
            if(valA || valB || cells[3].innerText.trim()) {
                result.push({
                    Id: idCounter++,
                    ...commonData,
                    Col_A: valA,
                    Col_B: valB,
                    Col_C: cells[3].innerText.trim(),
                    Col_D: cells[4].innerText.trim(),
                    Col_E: cells[5].innerText.trim(),
                    Col_F: cells[6].innerText.trim(),
                    Col_G: cells[7].innerText.trim(),
                    Col_Ct: cells[8].innerText.trim(),
                });
            }
        });
        return result;
    }

    function setStatus(msg) {
        document.getElementById('statusMsg').innerText = msg;
    }
</script>

</body>
</html>